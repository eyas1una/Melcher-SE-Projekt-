<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<!-- Three-step wizard transaction dialog -->
<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml"
           fx:controller="com.group_2.ui.finance.TransactionDialogController"
           fx:id="dialogOverlay"
           visible="false"
           managed="false"
           styleClass="dialog-overlay"
           stylesheets="@/css/styles.css"
           alignment="CENTER">

    <!-- STEP 1: Select Creditor & Debtors -->
    <VBox fx:id="step1Screen" styleClass="card dialog-surface" spacing="0"
          StackPane.alignment="CENTER" maxWidth="950" maxHeight="650" prefWidth="820">
        
        <!-- Header -->
        <HBox alignment="CENTER" spacing="15" styleClass="dialog-header">
            <Button text="X" onAction="#closeDialog"
                    styleClass="dialog-close-button"/>
            <Text text="Step 1: Select Participants" styleClass="dialog-title"/>
            <Region HBox.hgrow="ALWAYS"/>
        </HBox>

        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" >
            <VBox spacing="20" styleClass="dialog-body">
                
                <!-- Select Creditor Section -->
                <VBox spacing="12">
                    <Text text="Who paid?" styleClass="dialog-text-emphasis"/>
                    <Text text="Select the person who paid for this expense" styleClass="dialog-text-secondary"/>
                    <VBox fx:id="creditorListBox" spacing="8"/>
                </VBox>

                <Separator/>

                <!-- Select Debtors Section -->
                <VBox spacing="12">
                    <Text text="Who owes?" styleClass="dialog-text-emphasis"/>
                    <Text text="Select all people who should pay for this expense" styleClass="dialog-text-secondary"/>
                    <Button fx:id="selectAllDebtorsButton" text="Select All" onAction="#handleSelectAllDebtors"
                            styleClass="dialog-badge"/>
                    <VBox fx:id="debtorListBox" spacing="8"/>
                </VBox>

                <!-- Validation Error -->
                <Text fx:id="step1ValidationError" text="" visible="false" managed="false"
                      styleClass="dialog-label-error"/>
            </VBox>
        </ScrollPane>

        <!-- Footer with Next Button -->
        <HBox alignment="CENTER_RIGHT" spacing="10" styleClass="dialog-footer">
            <Button fx:id="step1NextButton" text="Next &gt;" onAction="#goToStep2"
                    styleClass="dialog-footer-button-primary"/>
        </HBox>
    </VBox>

    <!-- STEP 2: Description & Amount -->  
    <VBox fx:id="step2Screen" visible="false" managed="false" styleClass="card dialog-surface" spacing="0"
          StackPane.alignment="CENTER" maxWidth="950" maxHeight="650" prefWidth="820">
        
        <!-- Header -->
        <HBox alignment="CENTER" spacing="15" styleClass="dialog-header">
            <Button text="X" onAction="#closeDialog"
                    styleClass="dialog-close-button"/>
            <Text text="Step 2: Transaction Details" styleClass="dialog-title"/>
            <Region HBox.hgrow="ALWAYS"/>
        </HBox>

        <VBox spacing="20" styleClass="dialog-body" VBox.vgrow="ALWAYS">
            <!-- Summary -->
            <VBox spacing="6" styleClass="dialog-highlight-box">
                <Text fx:id="step2Summary" text="" styleClass="dialog-text-primary" wrappingWidth="420"/>
            </VBox>

            <!-- Description -->
            <VBox spacing="8">
                <Text text="Description" styleClass="dialog-text-emphasis"/>
                <TextField fx:id="descriptionField" promptText="e.g., Groceries, Dinner, Movie tickets..." 
                           styleClass="dialog-field dialog-field-small"/>
            </VBox>

            <!-- Amount -->
            <VBox spacing="8">
                <Text text="Total Amount" styleClass="dialog-text-emphasis"/>
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Text text="€" styleClass="dialog-text-emphasis"/>
                    <TextField fx:id="amountField" promptText="0.00" HBox.hgrow="ALWAYS"
                               styleClass="dialog-field dialog-field-large"/>
                </HBox>
            </VBox>

            <!-- Standing Order Option -->
            <VBox spacing="8">
                <CheckBox fx:id="standingOrderCheckbox" text="Make this a standing order (recurring)"
                          onAction="#handleStandingOrderToggle"
                          styleClass="dialog-text-emphasis"/>
                <HBox fx:id="standingOrderOptionsBox" spacing="12" alignment="CENTER_LEFT" 
                      visible="false" managed="false" >
                    <VBox spacing="4">
                        <Text text="Frequency" styleClass="dialog-label-secondary"/>
                        <ComboBox fx:id="frequencyComboBox" promptText="Select..."
                                  onAction="#handleFrequencyChange"
                                  styleClass="dialog-field" prefWidth="150"/>
                    </VBox>
                    <VBox fx:id="startDateBox" spacing="4" visible="false" managed="false">
                        <Text fx:id="startDateLabel" text="Start Date" styleClass="dialog-label-secondary"/>
                        <DatePicker fx:id="startDatePicker" promptText="Select..."
                                    styleClass="dialog-field" prefWidth="130"/>
                    </VBox>
                    <VBox fx:id="monthlyLastDayBox" spacing="4" alignment="CENTER_LEFT" visible="false" managed="false">
                        <Text text=" " styleClass="dialog-label-muted"/>
                        <CheckBox fx:id="monthlyLastDayCheckbox" text="Last day of month"
                                  onAction="#handleMonthlyLastDayToggle"
                                  styleClass="dialog-label-muted"/>
                    </VBox>
                </HBox>
            </VBox>

            <!-- Validation Error -->
            <Text fx:id="step2ValidationError" text="" visible="false" managed="false"
                  styleClass="dialog-label-error"/>
        </VBox>

        <!-- Footer with Back/Next Buttons -->
        <HBox alignment="CENTER_RIGHT" spacing="10" styleClass="dialog-footer">
            <Button text="&lt; Back" onAction="#goToStep1"
                    styleClass="dialog-footer-button-light"/>
            <Button fx:id="step2NextButton" text="Next &gt;" onAction="#goToStep3"
                    styleClass="dialog-footer-button-primary"/>
        </HBox>
    </VBox>

    <!-- STEP 3: Split Options -->
    <VBox fx:id="step3Screen" visible="false" managed="false" styleClass="card dialog-surface" spacing="0"
          StackPane.alignment="CENTER" maxWidth="950" maxHeight="650" prefWidth="820">
        
        <!-- Header -->
        <HBox alignment="CENTER" spacing="15" styleClass="dialog-header">
            <Button text="X" onAction="#closeDialog"
                    styleClass="dialog-close-button"/>
            <Text text="Step 3: Split Options" styleClass="dialog-title"/>
            <Region HBox.hgrow="ALWAYS"/>
        </HBox>

        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" >
            <VBox spacing="20" styleClass="dialog-body">
                <!-- Split Mode Selection -->
                <VBox spacing="12">
                    <Text text="How should this be split?" styleClass="dialog-text-emphasis"/>
                    <RadioButton fx:id="equalSplitRadio" text="Split equally" selected="true"
                                 onAction="#handleSplitModeChange" styleClass="dialog-text-emphasis"/>
                    <RadioButton fx:id="percentageSplitRadio" text="Split by percentage"
                                 onAction="#handleSplitModeChange" styleClass="dialog-text-emphasis"/>
                    <RadioButton fx:id="customAmountSplitRadio" text="Split by custom amounts"
                                 onAction="#handleSplitModeChange" styleClass="dialog-text-emphasis"/>
                </VBox>

                <!-- Equal Split Content -->
                <VBox fx:id="equalSplitContent" spacing="12">
                    <Text text="Each person will pay an equal share." styleClass="dialog-text-secondary"/>
                    <Text fx:id="equalSplitSummary" text="" styleClass="dialog-text-emphasis"/>
                </VBox>

                <!-- Percentage Split Content -->
                <VBox fx:id="percentageSplitContent" spacing="12" visible="false" managed="false">
                    <Text text="Enter percentage for each person." styleClass="dialog-text-secondary"/>
                    <VBox fx:id="percentageSplitParticipantsBox" spacing="8" styleClass="dialog-highlight-box"/>
                    <Text fx:id="percentageSplitSummary" text="Total: 0%" styleClass="dialog-text-secondary"/>
                </VBox>

                <!-- Custom Amount Split Content -->
                <VBox fx:id="customAmountSplitContent" spacing="12" visible="false" managed="false">
                    <Text text="Enter custom amount for each person." styleClass="dialog-text-secondary"/>
                    <VBox fx:id="customAmountSplitParticipantsBox" spacing="8" styleClass="dialog-highlight-box"/>
                    <Text fx:id="customAmountSplitSummary" text="Remaining: €0.00" styleClass="dialog-text-secondary"/>
                </VBox>
            </VBox>
        </ScrollPane>

        <!-- Footer with Back/Save Buttons -->
        <HBox alignment="CENTER_RIGHT" spacing="10" styleClass="dialog-footer">
            <Button text="&lt; Back" onAction="#goToStep2"
                    styleClass="dialog-footer-button-light"/>
            <Button fx:id="saveButton" text="Save Transaction" onAction="#saveTransaction"
                    styleClass="dialog-footer-button-primary"/>
        </HBox>
    </VBox>

</StackPane>
