<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<!-- Three-step wizard transaction dialog -->
<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml"
           fx:controller="com.group_2.ui.TransactionDialogController"
           fx:id="dialogOverlay"
           visible="false"
           managed="false"
           style="-fx-background-color: rgba(0,0,0,0.6);"
           alignment="CENTER">

    <!-- STEP 1: Select Creditor & Debtors -->
    <VBox fx:id="step1Screen" styleClass="card" spacing="0"
          style="-fx-max-width: 500; -fx-max-height: 600; -fx-padding: 0; -fx-background-color: white; -fx-background-radius: 16; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.15), 20, 0, 0, 4);">
        
        <!-- Header -->
        <HBox alignment="CENTER" spacing="15" style="-fx-padding: 20 24; -fx-border-color: #e5e7eb; -fx-border-width: 0 0 1 0; -fx-background-color: #f9fafb; -fx-background-radius: 16 16 0 0;">
            <Button text="✕" onAction="#closeDialog"
                    style="-fx-background-color: transparent; -fx-text-fill: #6b7280; -fx-font-size: 20px; -fx-cursor: hand; -fx-padding: 4;"/>
            <Text text="Step 1: Select Participants" style="-fx-font-size: 18px; -fx-font-weight: 700; -fx-fill: #111827;"/>
            <Region HBox.hgrow="ALWAYS"/>
        </HBox>

        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: white; -fx-background: white;">
            <VBox spacing="20" style="-fx-padding: 20 24;">
                
                <!-- Select Creditor Section -->
                <VBox spacing="12">
                    <Text text="Who paid?" style="-fx-font-size: 15px; -fx-font-weight: 600; -fx-fill: #111827;"/>
                    <Text text="Select the person who paid for this expense" style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                    <VBox fx:id="creditorListBox" spacing="8"/>
                </VBox>

                <Separator style="-fx-background-color: #e5e7eb;"/>

                <!-- Select Debtors Section -->
                <VBox spacing="12">
                    <Text text="Who owes?" style="-fx-font-size: 15px; -fx-font-weight: 600; -fx-fill: #111827;"/>
                    <Text text="Select all people who should pay for this expense" style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                    <VBox fx:id="debtorListBox" spacing="8"/>
                </VBox>

                <!-- Validation Error -->
                <Text fx:id="step1ValidationError" text="" visible="false" managed="false"
                      style="-fx-font-size: 12px; -fx-fill: #ef4444; -fx-font-weight: 500;"/>
            </VBox>
        </ScrollPane>

        <!-- Footer with Next Button -->
        <HBox alignment="CENTER_RIGHT" spacing="10" style="-fx-padding: 16 24; -fx-border-color: #e5e7eb; -fx-border-width: 1 0 0 0;">
            <Button fx:id="step1NextButton" text="Next →" onAction="#goToStep2"
                    style="-fx-background-color: #3b82f6; -fx-text-fill: white; -fx-background-radius: 8; -fx-padding: 10 24; -fx-cursor: hand; -fx-font-weight: 600; -fx-font-size: 13px;"/>
        </HBox>
    </VBox>

    <!-- STEP 2: Description & Amount -->  
    <VBox fx:id="step2Screen" visible="false" managed="false" styleClass="card" spacing="0"
          style="-fx-max-width: 500; -fx-max-height: 600; -fx-padding: 0; -fx-background-color: white; -fx-background-radius: 16; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.15), 20, 0, 0, 4);">
        
        <!-- Header -->
        <HBox alignment="CENTER" spacing="15" style="-fx-padding: 20 24; -fx-border-color: #e5e7eb; -fx-border-width: 0 0 1 0; -fx-background-color: #f9fafb; -fx-background-radius: 16 16 0 0;">
            <Button text="✕" onAction="#closeDialog"
                    style="-fx-background-color: transparent; -fx-text-fill: #6b7280; -fx-font-size: 20px; -fx-cursor: hand; -fx-padding: 4;"/>
            <Text text="Step 2: Transaction Details" style="-fx-font-size: 18px; -fx-font-weight: 700; -fx-fill: #111827;"/>
            <Region HBox.hgrow="ALWAYS"/>
        </HBox>

        <VBox spacing="20" style="-fx-padding: 20 24;" VBox.vgrow="ALWAYS">
            <!-- Summary -->
            <VBox spacing="6" style="-fx-background-color: #eff6ff; -fx-padding: 12; -fx-background-radius: 8;">
                <Text fx:id="step2Summary" text="" style="-fx-font-size: 13px; -fx-fill: #1e40af; -fx-font-weight: 500;" wrappingWidth="420"/>
            </VBox>

            <!-- Description -->
            <VBox spacing="8">
                <Text text="Description" style="-fx-font-size: 14px; -fx-fill: #111827; -fx-font-weight: 600;"/>
                <TextField fx:id="descriptionField" promptText="e.g., Groceries, Dinner, Movie tickets..." 
                           style="-fx-background-color: #f9fafb; -fx-border-color: #e5e7eb; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 12; -fx-font-size: 14px;"/>
            </VBox>

            <!-- Amount -->
            <VBox spacing="8">
                <Text text="Total Amount" style="-fx-font-size: 14px; -fx-fill: #111827; -fx-font-weight: 600;"/>
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Text text="€" style="-fx-font-size: 18px; -fx-fill: #6b7280; -fx-font-weight: 600;"/>
                    <TextField fx:id="amountField" promptText="0.00" HBox.hgrow="ALWAYS"
                               style="-fx-background-color: #f9fafb; -fx-border-color: #e5e7eb; -fx-border-radius: 8; -fx-background-radius: 8; -fx-padding: 12; -fx-font-size: 16px;"/>
                </HBox>
            </VBox>

            <!-- Validation Error -->
            <Text fx:id="step2ValidationError" text="" visible="false" managed="false"
                  style="-fx-font-size: 12px; -fx-fill: #ef4444; -fx-font-weight: 500;"/>
        </VBox>

        <!-- Footer with Back/Next Buttons -->
        <HBox alignment="CENTER_RIGHT" spacing="10" style="-fx-padding: 16 24; -fx-border-color: #e5e7eb; -fx-border-width: 1 0 0 0;">
            <Button text="← Back" onAction="#goToStep1"
                    style="-fx-background-color: #f3f4f6; -fx-text-fill: #374151; -fx-background-radius: 8; -fx-padding: 10 24; -fx-cursor: hand; -fx-font-weight: 600; -fx-font-size: 13px;"/>
            <Button fx:id="step2NextButton" text="Next →" onAction="#goToStep3"
                    style="-fx-background-color: #3b82f6; -fx-text-fill: white; -fx-background-radius: 8; -fx-padding: 10 24; -fx-cursor: hand; -fx-font-weight: 600; -fx-font-size: 13px;"/>
        </HBox>
    </VBox>

    <!-- STEP 3: Split Options -->
    <VBox fx:id="step3Screen" visible="false" managed="false" styleClass="card" spacing="0"
          style="-fx-max-width: 500; -fx-max-height: 600; -fx-padding: 0; -fx-background-color: white; -fx-background-radius: 16; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.15), 20, 0, 0, 4);">
        
        <!-- Header -->
        <HBox alignment="CENTER" spacing="15" style="-fx-padding: 20 24; -fx-border-color: #e5e7eb; -fx-border-width: 0 0 1 0; -fx-background-color: #f9fafb; -fx-background-radius: 16 16 0 0;">
            <Button text="✕" onAction="#closeDialog"
                    style="-fx-background-color: transparent; -fx-text-fill: #6b7280; -fx-font-size: 20px; -fx-cursor: hand; -fx-padding: 4;"/>
            <Text text="Step 3: Split Options" style="-fx-font-size: 18px; -fx-font-weight: 700; -fx-fill: #111827;"/>
            <Region HBox.hgrow="ALWAYS"/>
        </HBox>

        <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: white; -fx-background: white;">
            <VBox spacing="20" style="-fx-padding: 20 24;">
                <!-- Split Mode Selection -->
                <VBox spacing="12">
                    <Text text="How should this be split?" style="-fx-font-size: 14px; -fx-fill: #111827; -fx-font-weight: 600;"/>
                    <RadioButton fx:id="equalSplitRadio" text="Split equally" selected="true"
                                 onAction="#handleSplitModeChange" style="-fx-font-size: 14px; -fx-font-weight: 500;"/>
                    <RadioButton fx:id="percentageSplitRadio" text="Split by percentage"
                                 onAction="#handleSplitModeChange" style="-fx-font-size: 14px; -fx-font-weight: 500;"/>
                    <RadioButton fx:id="customAmountSplitRadio" text="Split by custom amounts"
                                 onAction="#handleSplitModeChange" style="-fx-font-size: 14px; -fx-font-weight: 500;"/>
                </VBox>

                <!-- Equal Split Content -->
                <VBox fx:id="equalSplitContent" spacing="12">
                    <Text text="Each person will pay an equal share." style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                    <Text fx:id="equalSplitSummary" text="" style="-fx-font-size: 13px; -fx-fill: #111827; -fx-font-weight: 600;"/>
                </VBox>

                <!-- Percentage Split Content -->
                <VBox fx:id="percentageSplitContent" spacing="12" visible="false" managed="false">
                    <Text text="Enter percentage for each person." style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                    <VBox fx:id="percentageSplitParticipantsBox" spacing="8"/>
                    <Text fx:id="percentageSplitSummary" text="Total: 0%" style="-fx-font-size: 13px; -fx-fill: #6b7280; -fx-font-weight: 500;"/>
                </VBox>

                <!-- Custom Amount Split Content -->
                <VBox fx:id="customAmountSplitContent" spacing="12" visible="false" managed="false">
                    <Text text="Enter custom amount for each person." style="-fx-font-size: 13px; -fx-fill: #6b7280;"/>
                    <VBox fx:id="customAmountSplitParticipantsBox" spacing="8"/>
                    <Text fx:id="customAmountSplitSummary" text="Remaining: €0.00" style="-fx-font-size: 13px; -fx-fill: #6b7280; -fx-font-weight: 500;"/>
                </VBox>
            </VBox>
        </ScrollPane>

        <!-- Footer with Back/Save Buttons -->
        <HBox alignment="CENTER_RIGHT" spacing="10" style="-fx-padding: 16 24; -fx-border-color: #e5e7eb; -fx-border-width: 1 0 0 0;">
            <Button text="← Back" onAction="#goToStep2"
                    style="-fx-background-color: #f3f4f6; -fx-text-fill: #374151; -fx-background-radius: 8; -fx-padding: 10 24; -fx-cursor: hand; -fx-font-weight: 600; -fx-font-size: 13px;"/>
            <Button fx:id="saveButton" text="Save Transaction" onAction="#saveTransaction"
                    style="-fx-background-color: #10b981; -fx-text-fill: white; -fx-background-radius: 8; -fx-padding: 10 24; -fx-cursor: hand; -fx-font-weight: 600; -fx-font-size: 13px;"/>
        </HBox>
    </VBox>

</StackPane>
